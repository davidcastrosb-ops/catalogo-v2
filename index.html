<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trhoncal Homes | Catálogo de Desarrollos – Guadalajara</title>
  <meta name="description" content="Catálogo de desarrollos en la ZMG con filtros por zona, precio, tipo y estatus." />
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <meta name="theme-color" content="#0f172a">
  <style>
    :root{--gold:#C9A227;--dark:#0f172a;--muted:#475569;--bg:#ffffff;--light:#f8fafc;--wa:#25D366;--border:#e2e8f0}
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Noto Sans,sans-serif;background:var(--bg);color:var(--dark)}
    a{color:inherit;text-decoration:none} img{max-width:100%;display:block}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}
    .btn{display:inline-block;padding:10px 16px;border-radius:999px;border:1px solid var(--gold);font-weight:600}
    .btn.primary{background:var(--gold);color:#fff;border-color:var(--gold)}
    .btn.ghost{background:transparent;color:var(--gold)}
    .btn.whatsapp{background:var(--wa);border-color:var(--wa);color:#fff}
    header{position:sticky;top:0;background:rgba(255,255,255,.95);backdrop-filter:saturate(180%) blur(8px);border-bottom:1px solid var(--border);z-index:50}
    header .wrap{display:flex;align-items:center;justify-content:space-between;height:72px}
    nav a{margin-left:18px;color:var(--muted)}
    .logo-img{height:50px}
    .hero{padding:32px 0;background:radial-gradient(1000px 420px at 80% -200px, rgba(201,162,39,.15), transparent)}
    .hero h1{font-size:clamp(26px,5vw,40px);line-height:1.1;margin:0 0 8px}
    .hero p{color:var(--muted);margin:0 0 18px}
    .filters{display:grid;grid-template-columns:repeat(12,1fr);gap:10px;padding:12px;border:1px solid var(--border);border-radius:14px;background:#fff}
    .filters > *{grid-column:span 12} @media(min-width:900px){ .filters>*{grid-column:span 3} }
    .filters label{display:block;font-weight:700;margin:0 0 6px}
    .filters input,.filters select{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px;margin-top:16px}
    .card{grid-column:span 12;background:#fff;border:1px solid var(--border);border-radius:16px;overflow:hidden;box-shadow:0 8px 22px rgba(0,0,0,.04);display:flex;flex-direction:column}
    @media(min-width:700px){.card{grid-column:span 6}} @media(min-width:1000px){.card{grid-column:span 4}}
    .card .p{padding:14px} .card h3{margin:0 0 6px;font-size:18px} .meta{color:var(--muted);font-size:14px}
    .thumb{width:100%;height:160px;object-fit:cover;background:#e2e8f0}
    .map-wrap{border:1px solid var(--border);border-radius:14px;overflow:hidden;margin-top:18px}
    #zmgMap{height:420px}
    footer{padding:28px 0;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="container wrap">
      <div style="display:flex;align-items:center;gap:10px">
        <img class="logo-img" src="assets/logo-trhoncal-flat.png" alt="Trhoncal Homes" loading="lazy" onerror="this.replaceWith(Object.assign(document.createElement('strong'),{textContent:'Trhoncal Homes'}))">
      </div>
      <nav>
        <a href="/">Inicio</a>
        <a href="#catalogo">Desarrollos</a>
        <a href="#contacto">Contacto</a>
        <a href="panel.html" title="Solo personal autorizado">Panel</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="container">
        <h1>Catálogo de desarrollos</h1>
        <p>Filtra por <strong>zona</strong>, <strong>precio</strong>, <strong>tipo</strong> y <strong>estatus</strong>.</p>
        <div class="filters">
          <div>
            <label for="f-search">Buscar</label>
            <input id="f-search" placeholder="Nombre, zona o ubicación…">
          </div>
          <div>
            <label for="f-zona">Zona</label>
            <select id="f-zona">
              <option value="">Todas</option>
              <option>Norte</option><option>Sur</option><option>Centro</option><option>Este</option><option>Oeste</option>
              <option>Norte (Tesistán)</option><option>Norte (Capital Norte)</option><option>Sur (Centro Sur)</option><option>Sur (Adolf Horn)</option><option>Sur (Santa Anita)</option><option>Este (Tonalá)</option>
            </select>
          </div>
          <div>
            <label for="f-tipo">Tipo</label>
            <select id="f-tipo">
              <option value="">Todos</option>
              <option>Casa</option>
              <option>Departamento</option>
            </select>
          </div>
          <div>
            <label for="f-estatus">Estatus</label>
            <select id="f-estatus">
              <option value="">Todos</option>
              <option>Entrega inmediata</option>
              <option>Preventa</option>
            </select>
          </div>
          <div>
            <label for="f-precio-min">Precio mínimo</label>
            <input id="f-precio-min" type="number" inputmode="numeric" placeholder="Ej. 700000">
          </div>
          <div>
            <label for="f-precio-max">Precio máximo</label>
            <input id="f-precio-max" type="number" inputmode="numeric" placeholder="Ej. 4000000">
          </div>
          <div>
            <label for="f-credito">Crédito</label>
            <select id="f-credito">
              <option value="">Todos</option>
              <option>Infonavit</option><option>Fovissste</option><option>Bancario</option>
            </select>
          </div>
          <div style="display:flex;align-items:flex-end;gap:8px">
            <button class="btn" id="btn-clear" type="button">Limpiar</button>
            <button class="btn primary" id="btn-apply" type="button">Aplicar</button>
          </div>
        </div>
      </div>
    </section>

    <section id="catalogo" class="section">
      <div class="container">
        <div id="cards" class="grid"></div>
        <div class="map-wrap"><div id="zmgMap"></div></div>
        <p class="meta" style="margin-top:6px">Ubicaciones de referencia (no reales). Solicita la dirección exacta con tu asesor.</p>
      </div>
    </section>

    <section id="contacto" class="section" style="border-top:1px solid var(--border)">
      <div class="container">
        <h2>Pide información por WhatsApp</h2>
        <form id="lead-form" autocomplete="on">
          <input type="hidden" id="desarrollo" name="desarrollo" value="Catálogo – Contacto General"/>
          <div class="grid" style="grid-template-columns:repeat(12,1fr);gap:12px">
            <div style="grid-column:span 4"><label for="nombre">Nombre(s)</label><input id="nombre" name="nombre" required placeholder="Tu nombre"/></div>
            <div style="grid-column:span 4"><label for="paterno">Apellido paterno</label><input id="paterno" name="paterno" required placeholder="Paterno"/></div>
            <div style="grid-column:span 4"><label for="materno">Apellido materno</label><input id="materno" name="materno" required placeholder="Materno"/></div>
            <div style="grid-column:span 4"><label for="whatsapp">WhatsApp</label><input id="whatsapp" name="whatsapp" required type="tel" placeholder="33 3724 1151"/></div>
            <div style="grid-column:span 4"><label for="correo">Correo electrónico</label><input id="correo" name="correo" required type="email" placeholder="tu@correo.com"/></div>
            <div style="grid-column:span 4">
              <label for="mensaje">Desarrollo de interés</label>
              <select id="mensaje" name="mensaje"></select>
            </div>
          </div>
          <div style="margin-top:12px;display:flex;gap:10px">
            <a id="send-wa" class="btn whatsapp" href="#">Solicitar por WhatsApp</a>
            <a class="btn ghost ask-fill" href="#">Solicitar ficha</a>
          </div>
        </form>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:space-between">
        <small>© <span id="year"></span> Trhoncal Homes. TR + HON + CAL.</small>
        <small>Privacidad · Términos · Aviso legal</small>
      </div>
    </div>
  </footer>

  <!-- Fallback de datos para abrir con file:// -->
  <script id="inline-data" type="application/json">[{"nombre": "Privada Fiori", "precio_txt": "$1,272,000", "precio_min": 1272000, "zona": "Norte", "tipo": "Casa", "estatus": "Entrega inmediata", "creditos": ["Infonavit", "Fovissste", "Bancario"], "ubicacion": "Carretera Colotlán km 8.5", "link": "https://fiori.3dhomes.com.mx/", "img": "fiori.jpg", "lat": 20.85513063567841, "lng": -103.44382990704854, "r": 500, "modelos": "Dalia · Violeta · Girasol"}, {"nombre": "Vitad", "precio_txt": "$2,385,000", "precio_min": 2385000, "zona": "Sur", "tipo": "Departamento", "estatus": "Preventa", "creditos": ["Infonavit", "Bancario"], "ubicacion": "Cerca de Plaza Outlet", "link": "https://vitad.3dhomes.com.mx/", "img": "vitad.jpg", "lat": 20.528637934369318, "lng": -103.47099269947094, "r": 1000, "modelos": "Apolo · Ares · Atena"}, {"nombre": "Alporta", "precio_txt": "$2,309,000", "precio_min": 2309000, "zona": "Sur", "tipo": "Departamento", "estatus": "Entrega inmediata", "creditos": ["Infonavit", "Bancario"], "ubicacion": "Centro Sur, Av. Jesús Michel", "link": "https://alporta.3dhomes.com.mx/", "img": "alporta.jpg", "lat": 20.56585009368569, "lng": -103.39184358831704, "r": 1500, "modelos": "Atria · Vela · Lira"}, {"nombre": "Zenith Norte", "precio_txt": "$3,724,000", "precio_min": 3724000, "zona": "Norte", "tipo": "Casa", "estatus": "Entrega inmediata", "creditos": ["Bancario", "Infonavit"], "ubicacion": "Por Av. Valdepeñas", "link": "https://zenith-norte.3dhomes.com.mx/", "img": "zenith-norte.jpg", "lat": 20.760672306868827, "lng": -103.40135523203546, "r": 1500, "modelos": "Toledo · Samos · León · Toledo RF"}, {"nombre": "Creta", "precio_txt": "$3,655,000", "precio_min": 3655000, "zona": "Norte (Capital Norte)", "tipo": "Casa", "estatus": "Entrega inmediata", "creditos": ["Bancario", "Infonavit"], "ubicacion": "Capital Norte", "link": "https://creta.3dhomes.com.mx/", "img": "creta.jpg", "lat": 20.786957705846113, "lng": -103.415476167784, "r": 1000, "modelos": "Samos"}, {"nombre": "Tossa", "precio_txt": "$3,900,000", "precio_min": 3900000, "zona": "Sur (Centro Sur)", "tipo": "Casa", "estatus": "Preventa", "creditos": ["Bancario"], "ubicacion": "Centro Sur, Av. Jesús Michel", "link": "https://tossa.3dhomes.com.mx/", "img": "tossa.jpg", "lat": 20.577262595694847, "lng": -103.42875268542423, "r": 1500, "modelos": "Goya · Picasso · Dalí · Miró · Dalí RG · Miró RG"}, {"nombre": "Vicenza", "precio_txt": "$3,200,000", "precio_min": 3200000, "zona": "Sur (Santa Anita)", "tipo": "Casa", "estatus": "Preventa", "creditos": ["Bancario"], "ubicacion": "Cerca de Galerías Santa Anita", "link": "https://vicenza.3dhomes.com.mx/", "img": "vicenza.jpg", "lat": 20.576687379299546, "lng": -103.49279375479182, "r": 1500, "modelos": "Padua · Capri"}, {"nombre": "Lavantia", "precio_txt": "$2,790,000", "precio_min": 2790000, "zona": "Sur (Adolf Horn)", "tipo": "Departamento", "estatus": "Entrega inmediata", "creditos": ["Infonavit", "Bancario"], "ubicacion": "Dentro del Periférico, Adolf Horn", "link": "https://lavantia.3dhomes.com.mx/", "img": "lavantia.jpg", "lat": 20.585819756098118, "lng": -103.36449417953972, "r": 1000, "modelos": "Luna"}, {"nombre": "Mirador del Bosque", "precio_txt": "$740,000", "precio_min": 740000, "zona": "Norte (Tesistán)", "tipo": "Casa", "estatus": "Entrega inmediata", "creditos": ["Infonavit", "Fovissste", "Bancario"], "ubicacion": "Carretera Colotlán km 8.5", "link": "https://mirador.3dhomes.com.mx/", "img": "mirador.jpg", "lat": 20.856987846653993, "lng": -103.44609164389949, "r": 1000, "modelos": "Nardo · Oliva"}, {"nombre": "Vistas del Pedregal", "precio_txt": "$1,080,000", "precio_min": 1080000, "zona": "Este (Tonalá)", "tipo": "Casa", "estatus": "Entrega inmediata", "creditos": ["Infonavit", "Fovissste", "Bancario"], "ubicacion": "Santa Martha, Tonalá", "link": "https://vistas.3dhomes.com.mx/", "img": "vistas.jpg", "lat": 20.60739235653331, "lng": -103.16645128376169, "r": 1000, "modelos": "Unifamiliar 2–3 rec"}, {"nombre": "Solum", "precio_txt": "Consultar", "precio_min": 0, "zona": "Sur (Centro Sur)", "tipo": "Departamento", "estatus": "Preventa", "creditos": ["Bancario"], "ubicacion": "Centro Sur, Av. Jesús Michel", "link": "https://solum.3dhomes.com.mx/", "img": "solum.jpg", "lat": 20.537578254725435, "lng": -103.40399763462109, "r": 1000, "modelos": "2–3 recámaras · Amenidades"}]</script>

  <script>
    const WA_DEST  = "523337241151";
    const ENDPOINT = "https://script.google.com/macros/s/AKfycbwPuVXGIwLcF-KOPDuOch06KM72fEU0MpZE_xU7NWtFhZb5DqHl4ueeVH7K0bsWtczQtQ/exec";
    document.getElementById('year').textContent = new Date().getFullYear();

    const state = { data:[], filtered:[], map:null, layer:null };

    function money(n){ return n? n.toLocaleString('es-MX',{style:'currency',currency:'MXN',maximumFractionDigits:0}) : 'Consultar'; }

    function renderCards(arr){
      const wrap = document.getElementById('cards'); wrap.innerHTML='';
      arr.forEach(it=>{
        const el = document.createElement('article');
        el.className = 'card';
        el.innerHTML = `
          <img class="thumb" src="assets/${it.img}" alt="${it.nombre}" loading="lazy">
          <div class="p">
            <h3>${it.nombre}</h3>
            <div class="meta">Desde <strong>${it.precio_txt || money(it.precio_min)}</strong> · ${it.modelos||''}</div>
            <div class="meta">Zona: ${it.zona} · ${it.tipo} · ${it.estatus}</div>
            <div class="meta">Ubicación aprox.: ${it.ubicacion}</div>
            <div class="row" style="display:flex;align-items:center;justify-content:space-between;gap:8px;margin-top:10px">
              <a class="btn primary" href="${it.link}" target="_blank" rel="noopener">Ver página</a>
              <a class="btn ghost" href="https://wa.me/${WA_DEST}?text=${encodeURIComponent('Hola Trhoncal Homes, me interesa '+it.nombre)}" target="_blank" rel="noopener">WhatsApp</a>
            </div>
          </div>`;
        wrap.appendChild(el);
      });
    }

    function renderMap(arr){
      if(!state.map){
        const link=document.createElement('link'); link.rel='stylesheet'; link.href='https://unpkg.com/leaflet@1.9.4/dist/leaflet.css'; document.head.appendChild(link);
        const s=document.createElement('script'); s.src='https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
        s.onload=()=>{ initLeaflet(arr); }; document.body.appendChild(s);
      }else{
        state.layer.clearLayers();
        const bounds=[];
        arr.forEach(it=>{
          if(!(isFinite(it.lat)&&isFinite(it.lng))) return;
          const circle=L.circle([it.lat,it.lng],{radius:it.r||1200,color:'#C9A227',weight:2,fillOpacity:.12}).addTo(state.layer);
          circle.bindPopup(`<strong>${it.nombre}</strong><br><a href="${it.link}" target="_blank" rel="noopener">Abrir página</a>`);
          bounds.push([it.lat,it.lng]);
        });
        if(bounds.length){ state.map.fitBounds(bounds,{padding:[20,20]}); }
      }
    }
    function initLeaflet(arr){
      const map = L.map('zmgMap').setView([20.67,-103.35], 11);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19, attribution:'© OpenStreetMap'}).addTo(map);
      const layer=L.layerGroup().addTo(map);
      state.map=map; state.layer=layer;
      renderMap(arr);
    }

    function applyFilters(){
      const q = (document.getElementById('f-search').value||'').toLowerCase();
      const zona = document.getElementById('f-zona').value;
      const tipo = document.getElementById('f-tipo').value;
      const estatus = document.getElementById('f-estatus').value;
      const pmin = parseInt(document.getElementById('f-precio-min').value||'0',10);
      const pmax = parseInt(document.getElementById('f-precio-max').value||'0',10);
      const credito = document.getElementById('f-credito').value;
      state.filtered = state.data.filter(it=>{
        const hitQ = !q || [it.nombre,it.zona,it.ubicacion].join(' ').toLowerCase().includes(q);
        const hitZona = !zona || (it.zona||'').toLowerCase().includes(zona.toLowerCase());
        const hitTipo = !tipo || it.tipo===tipo;
        const hitEst = !estatus || it.estatus===estatus;
        const v = parseInt(it.precio_min||0,10);
        const hitPmin = !pmin || v===0 || v>=pmin;
        const hitPmax = !pmax || v===0 || v<=pmax;
        const hitCred = !credito || (Array.isArray(it.creditos) && it.creditos.includes(credito));
        return hitQ && hitZona && hitTipo && hitEst && hitPmin && hitPmax && hitCred;
      });
      renderCards(state.filtered);
      renderMap(state.filtered);
      const sel = document.getElementById('mensaje'); sel.innerHTML='';
      state.filtered.forEach(it=> sel.add(new Option(it.nombre,it.nombre)));
    }

    function loadData(){
      fetch('data/desarrollos.json',{cache:'no-store'})
        .then(r=>r.json())
        .then(arr=>init(arr))
        .catch(()=>{
          try{
            const raw = document.getElementById('inline-data').textContent;
            const arr = JSON.parse(raw);
            init(arr);
          }catch(e){
            console.error('No se pudieron cargar datos', e);
          }
        });
    }

    function init(arr){
      state.data = arr; state.filtered = arr.slice();
      renderCards(arr); renderMap(arr);
      const sel = document.getElementById('mensaje'); sel.innerHTML='';
      arr.forEach(it=> sel.add(new Option(it.nombre,it.nombre)));
    }

    function buildMessage(d){
      const tel = (d.whatsapp||'').replace(/\D+/g,'');
      return `Hola Trhoncal Homes, me interesa ${d.desarrollo||d.mensaje||'el desarrollo'}. ` +
             `Soy ${[d.nombre,d.paterno,d.materno].filter(Boolean).join(' ')}. ` +
             `Mi correo es ${d.correo}. ` +
             `Mi WhatsApp es ${tel}.`;
    }
    function formDataObject(form){ return Object.fromEntries(new FormData(form).entries()); }
    async function submitLead(){
      const form = document.getElementById('lead-form');
      if(!form.reportValidity()) return;
      const d = formDataObject(form);
      try{ await fetch(ENDPOINT, {method:'POST', headers:{'Content-Type':'application/x-www-form-urlencoded;charset=UTF-8'}, body:new URLSearchParams(d).toString()}); }catch(e){}
      location.href = `https://wa.me/${WA_DEST}?text=${encodeURIComponent(buildMessage(d))}`;
    }

    document.getElementById('btn-apply').onclick = applyFilters;
    document.getElementById('btn-clear').onclick = ()=>{
      ['f-search','f-zona','f-tipo','f-estatus','f-precio-min','f-precio-max','f-credito'].forEach(id=>{
        const el = document.getElementById(id); if(el.tagName==='SELECT') el.selectedIndex=0; else el.value='';
      });
      applyFilters();
    };
    document.getElementById('send-wa').addEventListener('click', e=>{ e.preventDefault(); submitLead(); });

    loadData();
  </script>
</body>
</html>
