<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Panel · Trhoncal Homes</title>
  <style>
    :root{--gold:#C9A227;--dark:#0f172a;--muted:#475569;--border:#e2e8f0}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;margin:0;background:#fff;color:#0f172a}
    .wrap{max-width:980px;margin:20px auto;padding:0 16px}
    .card{border:1px solid var(--border);border-radius:14px;padding:16px}
    input,select,textarea{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;font-size:16px}
    label{font-weight:700;margin:10px 0 6px;display:block}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .row>div{flex:1 1 240px}
    .btn{display:inline-block;padding:10px 14px;border-radius:999px;border:1px solid var(--gold);background:var(--gold);color:#fff;font-weight:700}
    table{width:100%;border-collapse:collapse;margin-top:14px}
    th,td{border:1px solid var(--border);padding:8px;text-align:left}
    .right{float:right}
    .muted{color:var(--muted);font-size:14px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Panel de control</h1>
    <p class="muted">Protección simple. Cambia la clave en el código si lo deseas.</p>
    <div id="gate" class="card">
      <label>Contraseña</label>
      <input id="pwd" type="password" placeholder="Escribe la clave"/>
      <button class="btn" id="btn-login">Entrar</button>
      <p class="muted">Clave por defecto: <code>trhoncal2025</code> (puedes cambiarla en <strong>panel.html</strong>)</p>
    </div>

    <div id="panel" class="card" style="display:none">
      <div class="row">
        <div><label>Nombre</label><input id="nombre"/></div>
        <div><label>Precio (texto)</label><input id="precio" placeholder="$1,272,000"/></div>
        <div><label>Ubicación aprox.</label><input id="ubicacion"/></div>
      </div>
      <div class="row">
        <div><label>Enlace página</label><input id="link"/></div>
        <div><label>Imagen (archivo en assets/)</label><input id="img" placeholder="fiori.jpg"/></div>
      </div>
      <div class="row">
        <div><label>Latitud</label><input id="lat" type="number" step="any"/></div>
        <div><label>Longitud</label><input id="lng" type="number" step="any"/></div>
        <div><label>Radio (m)</label><input id="r" type="number" step="1" value="1000"/></div>
      </div>
      <div class="row">
        <div><label>Modelos/Notas</label><input id="modelos" placeholder="Dalia · Violeta · Girasol"/></div>
      </div>
      <button class="btn" id="btn-add">Agregar / Actualizar</button>
      <button class="btn right" id="btn-export">Exportar JSON</button>

      <table id="tabla">
        <thead><tr><th>Nombre</th><th>Precio</th><th>Ubicación</th><th>Imagen</th><th>Lat</th><th>Lng</th><th>R</th><th>Acciones</th></tr></thead>
        <tbody></tbody>
      </table>

      <p class="muted">Hoy el catálogo del index está maquetado a mano. Desde aquí puedes preparar el <code>data/desarrollos.json</code>; descarga y sustitúyelo cuando migremos el index a lectura dinámica.</p>
    </div>
  </div>

  <script>
    const PASSWORD = "trhoncal2025";
    const tabla = document.querySelector("#tabla tbody");
    const gate = document.getElementById('gate');
    const panel = document.getElementById('panel');

    document.getElementById('btn-login').onclick = () => {
      const ok = (document.getElementById('pwd').value === PASSWORD);
      if(!ok) return alert('Clave incorrecta');
      gate.style.display='none'; panel.style.display='block';
      cargar();
    };

    const storeKey = 'th_desarrollos';
    function cargar(){
      const base = (localStorage.getItem(storeKey) || '[]');
      const arr = JSON.parse(base);
      render(arr);
    }
    function guardar(arr){
      localStorage.setItem(storeKey, JSON.stringify(arr));
      render(arr);
    }
    function render(arr){
      tabla.innerHTML = '';
      arr.forEach((it,idx)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = \`
          <td>\${it.nombre||''}</td><td>\${it.precio||''}</td><td>\${it.ubicacion||''}</td>
          <td>\${it.img||''}</td><td>\${it.lat||''}</td><td>\${it.lng||''}</td><td>\${it.r||''}</td>
          <td><button data-i="\${idx}">Editar</button> <button data-d="\${idx}">Borrar</button></td>
        \`;
        tabla.appendChild(tr);
      });
      tabla.querySelectorAll('button[data-i]').forEach(b=>b.onclick=()=>editar(parseInt(b.dataset.i)));
      tabla.querySelectorAll('button[data-d]').forEach(b=>b.onclick=()=>borrar(parseInt(b.dataset.d)));
    }
    function editar(i){
      const arr = JSON.parse(localStorage.getItem(storeKey) || '[]');
      const it = arr[i];
      ['nombre','precio','ubicacion','link','img','lat','lng','r','modelos'].forEach(id=>{
        const el=document.getElementById(id); if(el) el.value = it[id] ?? '';
      });
    }
    function borrar(i){
      const arr = JSON.parse(localStorage.getItem(storeKey) || '[]');
      arr.splice(i,1); guardar(arr);
    }
    document.getElementById('btn-add').onclick = ()=>{
      const it = {};
      ['nombre','precio','ubicacion','link','img','lat','lng','r','modelos'].forEach(id=>{
        const el=document.getElementById(id); it[id]=el.value;
      });
      const arr = JSON.parse(localStorage.getItem(storeKey) || '[]');
      const ix = arr.findIndex(x=>x.nombre===it.nombre);
      if(ix>=0) arr[ix]=it; else arr.push(it);
      guardar(arr);
    };
    document.getElementById('btn-export').onclick = ()=>{
      const arr = JSON.parse(localStorage.getItem(storeKey) || '[]');
      const blob = new Blob([JSON.stringify(arr,null,2)],{type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'desarrollos.json';
      a.click();
    };
  </script>
</body>
</html>
